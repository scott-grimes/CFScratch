<!DOCTYPE html>
<html>
<title>Cpu Emulator Page</title></title>
<head>
<script src="CpuEmulator.js"
    type="text/javascript"></script><script>
/**
 * A CPU emulator
 */
    

    var CPU;
    var ROM = [];
function fetchTextFromFile(evt) {
    //Retrieve the first file
    var f = evt.target.files[0]; 
    if (f) {
      var r = new FileReader();
      r.onload = function(e) { 
	      var contents = e.target.result;
         document.getElementById("ROM").value = contents;
          contents = contents.split('\n');
          ROM = [];
          for(var i = 0;i<contents.length;i++){
              ROM.push(contents[i]);
          }
          resetCPU();
      }
      r.readAsText(f);
      
    } else { 
      alert("Failed to load file");
    }
  }
    
function verifyMachineCode(value){
    
}
    
function resetCPU(evt){
        CPU = new CpuEmulator(ROM);
        CPU.M[0] = 3;
        updateCPUValues();
        window.c = CPU;
        window.r = ROM;
}
    
function getA(){
    document.getElementById('A').value = CPU.A;
}
    function getPC(){
    document.getElementById('PC').value = CPU.PC;
}
    function getD(){
    document.getElementById('D').value = CPU.D;
}
    function getAluOut(){
    document.getElementById('ALUOUT').value = CPU.ALUOUT;
}
    function getMemory(){
        var m = CPU.M;
        document.getElementById('RAM').value = '';
        for (var key in m) {
            document.getElementById('RAM').value+=key+': '+m[key]+'\n';
        }
    }
function updateCPUValues(){
        getA();
        getPC();
        getD();
        getAluOut();
        getMemory();
    }
function step(evt){
        if(CPU){
            CPU.execute();
            updateCPUValues();
        }
    }
function run(evt){
        for(var i = 0;i<1000;i++)
            step();
    }

window.onload = function() {
    
   
    
  var initialvalue = "no file loaded";
    
    
   document.getElementById("ROM").value = initialvalue;
    
   var blergaaa = initialvalue.split('\n');
          for(var i = 0;i<blergaaa.length;i++){
              ROM.push(blergaaa[i]);
          }
    window.r = ROM;
    
    resetCPU();

document.getElementById('fileUploader').addEventListener('change', fetchTextFromFile);
document.getElementById('resetbutton').addEventListener('click', resetCPU, false);
document.getElementById('stepbutton').addEventListener('click', step, false);
document.getElementById('runbutton').addEventListener('click', run,false);
   
   
    /*
   document.getElementById("runbutton").onclick = function () {
   var romboxvalue = document.getElementById("ROM").value;
   
   var m = document.getElementById("outputBox");
   var m1 = document.getElementById("compilerMessage");
   var answer;
   m1.value = 'Compiling...';
   try{
       m.value = '';
       var a = new Analyzer(jackTest);
       while(a.hasMoreTokens()){
           var token = a.advance();
           m.value += token+'\t\t\t('+a.tokenType(token)+')\n';
       }
       m1.value = 'Analyzed Successfully!'
   }
   catch(err){
       m.value = '';
       m1.value = 'Error: '+err;
   
   }
       
       
   m = document.getElementById("outputBox2");
   try{
       m.value = '';
       var a = new CompileJack(jackTest);
       for(var i = 0;i<a.lines.length;i++){
           m.value += a.lines[i]+'\n';
       }
       m1.value = 'Analyzed Successfully!'
   }
   catch(err){
       m1.value = 'Error: '+err;
   
   }
}
*/
}
    
</script>
</head>
<body>
<div class="row">
  <div class="column">
    Load your Binary or Assembly file, then step through your program.<br>
    <input id="fileUploader" name="myFile" type="file" accept=".asm, .hack"><br>
    ROM<br>
   <textarea id="ROM" rows="10" cols="20" readonly></textarea><br>
    View:  <button type="button" id="viewassembly" >Assembly</button> 
      <button type="button" id="viewmachinecode" >Binary</button><br>
    <button type="button" id="resetbutton" >Reset</button>
    <button type="button" id="stepbutton" >Step</button>
    <button type="button" id="runbutton" >Step x 1000</button><br>
      PC: <textarea id="PC" rows="1" cols="10" readonly></textarea>
    </div>
  <div class="column">
      RAM<br>
    <textarea id="RAM" rows="10" cols="20" readonly></textarea><br>
      D: <textarea id="D" rows="1" cols="10" readonly></textarea>
      A: <textarea id="A" rows="1" cols="10" readonly></textarea>
      ALU Output: <textarea id="ALUOUT" rows="1" cols="10" readonly></textarea>
    
    </div>
</div>
<br>
<input type="text" id="compilerMessage" size="44" readonly><br>
<br>


</body>
</html>
