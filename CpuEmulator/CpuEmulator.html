<!DOCTYPE html>
<html>
<title>Cpu Emulator Page</title></title>
<head>
<script src="CpuEmulator.js"
    type="text/javascript"></script><script>
/**
 * A translator from our high level language to our VM language
 */

window.onload = function() {
    
    document.getElementById("downloadButton").onclick = function () {
        var textToSave = document.getElementById("outputBox2").value;
        saveTextAsFile( textToSave )
    }
    
    
    
function fetchTextFromFile(evt) {
    //Retrieve the first file
    var f = evt.target.files[0]; 
    if (f) {
      var r = new FileReader();
      r.onload = function(e) { 
	      var contents = e.target.result;
         document.getElementById("inputBox").value = contents;
          
          updateDownloadFileName(f.name);
          
      }
      r.readAsText(f);
      
    } else { 
      alert("Failed to load file");
    }
  }
    

document.getElementById('fileUploader').addEventListener('change', fetchTextFromFile, false);
   
    
    
    
   document.getElementById("inputBox").value = "";
    
   document.getElementById("runbutton").onclick = function () {
   var jackTest = document.getElementById("ROM").value;
   
   var m = document.getElementById("outputBox");
   var m1 = document.getElementById("compilerMessage");
   var answer;
   m1.value = 'Compiling...';
   try{
       m.value = '';
       var a = new Analyzer(jackTest);
       while(a.hasMoreTokens()){
           var token = a.advance();
           m.value += token+'\t\t\t('+a.tokenType(token)+')\n';
       }
       m1.value = 'Analyzed Successfully!'
   }
   catch(err){
       m.value = '';
       m1.value = 'Error: '+err;
   
   }
       
       
   m = document.getElementById("outputBox2");
   try{
       m.value = '';
       var a = new CompileJack(jackTest);
       for(var i = 0;i<a.lines.length;i++){
           m.value += a.lines[i]+'\n';
       }
       m1.value = 'Analyzed Successfully!'
   }
   catch(err){
       m1.value = 'Error: '+err;
   
   }
}
}
    
</script>
</head>
<body>
<div class="row">
  <div class="column">
    Load your Binary or Assembly file, then step through your program.<br>
    <input id="fileUploader" name="myFile" type="file" accept=".txt, .jack"><br>
    ROM
    <textarea id="ROM" rows="10" cols="20"></textarea><br>
    <button type="button" id="runbutton" >Reset</button>
    <button type="button" id="runbutton" >Step</button>
    <button type="button" id="runbutton" >Run</button>
    </div>
  <div class="column">
      RAM
    <textarea id="RAM" rows="10" cols="10" readonly></textarea><br>
      D: <textarea id="D" rows="1" cols="10" readonly></textarea>
      A: <textarea id="A" rows="1" cols="10" readonly></textarea>
      M[A]: <textarea id="M" rows="1" cols="10" readonly></textarea>
      ALU Output: <textarea id="ALUOUT" rows="1" cols="10" readonly></textarea>
    
    </div>
</div>
<br>
<input type="text" id="compilerMessage" size="44" readonly><br>
<br>


</body>
</html>
