<!doctype html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=UTF-8" />
<script type="text/javascript" src="circuits.js"></script>
    <script
      src="https://code.jquery.com/jquery-3.2.1.min.js"
      integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
      crossorigin="anonymous"></script>
<script type="text/javascript" src="simcirjs/simcir.js"></script>
<link rel="stylesheet" type="text/css" href="simcirjs/simcir.css" />
<script type="text/javascript" src="simcirjs/simcir-basicset.js"></script>
<link rel="stylesheet" type="text/css" href="simcirjs/simcir-basicset.css" />
<script type="text/javascript" src="simcirjs/simcir-library.js"></script>
<script type="text/javascript" src="customComponents.js"></script>
<script type="text/javascript" src="tester.js"></script>
<style type="text/css">
* {
  font-family: arial, sans-serif;
}

</style>
<title>SimcirJS</title>
<script type="text/javascript">
    
    
    var getCircuitData = function() {
        var $s = simcir; 
         var $mysim = $('#circuitBox');
    return $s.controller(
        $mysim.find('.simcir-workspace') ).data();
  };
    
    var setCircuitData = function(data){
        
    simcir.setupSimcir( $('#circuitBox'), data );
  
    }
    
    
    
    var test = function(){
        
        var data = getCircuitData();
        var results = runTest(data.tests)
        console.log(results);
        /*
        var getIndexOfLabel = function(label){
        for(var i = 0;i<data.devices.length;i++){
            if (data.devices[i]['label']===label)
                return i;
        }
        return null;
    }
        var getState  = function(label){
            var i = getIndexOfLabel(label);
            return data.devices[i].state['on']
        }
        
        var setState = function(label,state){
            var i = getIndexOfLabel(label);
            return data.devices[i].state['on'] = state;
            
        }
        
        console.log('initial: ', getState("IN"));
        setState("IN",false);
        setCircuitData(data);        
        console.log('after false: ', getState("IN"));
        
        console.log('initial: ', getState("IN"));
        setState("IN",true);
        setCircuitData(data);
        console.log('after true: ', getState("IN"));
        return;
        */
    };
  
    function setLibrary (itemName){
        var data = {};
        data["width"] = 800;
        data["height"]=400;
        if(itemName!=='RESET'){
            data["toolbox"] =toolboxes[itemName];
            if(devices[itemName])
                data["devices"] = devices[itemName]["devices"];
                data["connectors"] = devices[itemName]["connectors"]
                data["tests"] = devices[itemName]["tests"]
        }
         
         var $s = simcir;
         var $mysim = $('#circuitBox');

        $s.setupSimcir($mysim,data)
        
        return;
    }
    window.onload = function(){
        //registerTestingComponents();
        
        var toolbar = document.getElementById("toolbar");
        //used to reset
        var myButton = document.createElement("input");
            myButton.type = "button";
            var itemName = 'RESET';
            myButton.value = itemName
            myButton.id = 'RESET_button';
            toolbar.appendChild(myButton);
        document.getElementById("RESET_button").addEventListener("click", function(){setLibrary(this.value)},false);
        
        //add all our stuff
        for(var i = 0;i<thingsToBuild.length;i++){
            if(i%8===0){
                toolbar.appendChild( document.createElement('br') );
            }
            var myButton = document.createElement("input");
            myButton.type = "button";
            var itemName = thingsToBuild[i];
            myButton.value = itemName
            myButton.id = itemName+'_button';
            toolbar.appendChild(myButton);
            document.getElementById(myButton.id).addEventListener("click", function(){setLibrary( this.value)},false);
            
  }
      document.getElementById("test").addEventListener("click", function(){ test() },false);  
    };
    
</script>
</head>
<body>

<h1>Circuits</h1>


<h2>Usage</h2>
<ul>
  <li>Choose a device from the toolbox and move to right side.</li>
  <li>Connect them by drag operation.</li>
  <li>Click an input node to disconnect.</li>
  <li>Move a device back to the toolbox if you don't use.</li>
  <li>Ctrl+Click(Mac:command+Click) to toggle view (Live circuit or JSON data).</li>
  <li>Double-Click a label to edit device name.</li>
  <li>Double-Click a library to open the circuit inside.</li>
</ul>
<div id="toolbar"></div>
<!--
Specify width and height only.
All the other attributes will be used defaults.
-->
<div class="simcir" id="circuitBox">
{
  "width":800,
  "height":400
}
</div>
<br>
<input type="button" id="test" value="Test"></input>
Ctrl+Click(Mac:command+Click) on your circuit and copy a circuit data.




</body>
</html>
